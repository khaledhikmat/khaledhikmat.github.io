
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Khaled Hikmat - ASP .NET Web API Deferred Execution</title>
        <meta name="description" content="Coding Thoughts" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Khaled Hikmat" href="/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="Khaled Hikmat" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Khaled Hikmat" />
        <meta name="msapplication-tooltip" content="Khaled Hikmat" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Khaled Hikmat - ASP .NET Web API Deferred Execution" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://khaledhikmat.github.io/posts/2013-08-29-asp-net-web-api-deferred-execution" />
        <!-- TODO: More social graph meta tags -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>     
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/Please-compressed.js"></script>
        <script src="/assets/js/background-check.min.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->
        
        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Khaled Hikmat</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About Me</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header" style="background-image: url(&quot;images/liquid.jpg&quot;)">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>ASP .NET Web API Deferred Execution</h1>
        <h2 class="subheading">Something to run after the Web API excecutes</h2>
    <div class="meta">        
Published on Thursday, August 29, 2013<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/ASPNET" class="btn btn-default btn-xs">ASP.NET</a>
                    <a role="button" href="/tags/WebAPI" class="btn btn-default btn-xs">WebAPI</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<p>I have an ASP.NET Web API project with a SignalR hub that I have been working for a while. One of the purposes of the SignalR hub is to deliver print jobs to remote printers via remote agents. The agents are SignalR .NET clients which receive the print job requests via a SignalR broadcast and determine whether the print job is intended for them by examining the 'printer' attribute of the print job.</p>
<p>The problem I am trying to solve is in the case of failure! If the job fails to print (for whatever reason... the agent is offline, the printer is jammed or out of paper), there must be way to recover. Here is what I really wanted....re-try the print if the print date was not set on the print job within 10 seconds of the original send date. If the re-try counter is exhausted, the hub will fetch a backup printer (configured for that specific account) and switch the print job print and re-submit the print job.</p>
<p>So I needed a way to monitor each print job after it has been sent off to the agent. I did not want to use a recurring timer because it would not be per specific job and I can't use the system (i.e. Windows) services or time scheduler because I am running in the cloud on a shared server. By the way, this service is not expected to process thousands of print jobs a minutes...it is a lay back service that needs to process about 100-200 print jobs a day maximum.</p>
<p>Searching StackOverflow, I found many techniques. Examples:</p>
<ul>
<li><a href="http://stackoverflow.com/questions/4329859/how-to-call-function-on-timer-asp-net-mvc">http://stackoverflow.com/questions/4329859/how-to-call-function-on-timer-asp-net-mvc</a></li>
<li><a href="http://stackoverflow.com/questions/542804/best-way-to-run-scheduled-tasks">http://stackoverflow.com/questions/542804/best-way-to-run-scheduled-tasks</a></li>
</ul>
<p>Also here is a nice time trigger that can be useful for different situations: <a href="http://atrigger.com/">http://atrigger.com/</a>. It relies on scheduling a task at 'a trigger' and then, after the time elapses, 'a trigger' will call back on certain URL. Triggers can be set up in many different ways: every x minutes, once per month, etc.</p>
<p>Eventually I found two techniques that work:</p>
<ul>
<li>The first one relies on ThreadPool.RegisterWaitForSingleObject which is documented in MSDN. It basically borrows a worker thread from the pool and runs at a specified time.</li>
<li>The second technique relies on inserting an expirable cache item and do something at the time of the expiration callback:  <a href="http://blog.stackoverflow.com/2008/07/easy-background-tasks-in-aspnet/">http://blog.stackoverflow.com/2008/07/easy-background-tasks-in-aspnet/</a></li>
</ul>
<p>Given that my service is not in high-demand, I opted to use the second technique which is really simple and seems to work quite well.</p>



                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12 text-center">
                    <p class="copyright text-muted">
                        Copyright © 2018
                        <br />
                            <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
                        |
                            <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <strong><a href="https://wyam.io">Generated by Wyam</a></strong>
                    </p>
                </div>
        </div>
</div>

                </footer> 

                
                <script>hljs.initHighlightingOnLoad();</script>


                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

