
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Khaled Hikmat - Web Tests Thoughts</title>
        <meta name="description" content="Coding Thoughts" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Khaled Hikmat" href="/feed.rss" />
        <link type="application/atom+xml" rel="alternate" title="Khaled Hikmat" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Khaled Hikmat" />
        <meta name="msapplication-tooltip" content="Khaled Hikmat" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Khaled Hikmat - Web Tests Thoughts" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://khaledhikmat.github.io/posts/2017-02-15-web-test-thoughts" />
        <!-- TODO: More social graph meta tags -->

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>     
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/clean-blog.js"></script>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/Please-compressed.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Khaled Hikmat</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                <li><a href="/about">About</a></li>
<li><a href="/posts">Archive</a></li>
<li><a href="/tags">Tags</a></li> 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Web Tests Thoughts</h1>
        <h2 class="subheading">Web Test Thoughts</h2>
    <div class="meta">        
Published on Wednesday, February 15, 2017<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/azure-functions" class="btn btn-default btn-xs">Azure Functions</a>
                    <a role="button" href="/tags/powerbi" class="btn btn-default btn-xs">PowerBI</a>
                    <a role="button" href="/tags/service-fabric" class="btn btn-default btn-xs">Service Fabric</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<p>If a Web App is deployed on Azure, both the <a href="https://azure.microsoft.com/en-us/services/application-insights/">App Insights</a> and <a href="https://azure.microsoft.com/en-us/services/app-service/web/">Web Apps</a> offer a utility that can hammer the app's endpoints from different regions. While this functionality is quite nice and comes bundled in, it is considered an alert-based system and is slightly rudimentary as one cannot customize the test or get access to the full results easily. This post describes an alternative approach that uses <a href="https://azure.microsoft.com/en-us/services/functions/">Azure Functions</a> or <a href="https://azure.microsoft.com/en-us/services/service-fabric/">Service Fabric</a> to implement a web test that can test and endpoint and report its test to PowerBI in real time.</p>
<p>What I really wanted to do is to conduct a web test for a duration of time from different regions against a new product's endpoints at launch time and immediately view the test results with executives.</p>
<h2 id="azure-functions">Azure Functions</h2>
<p>Briefly, here is what I decided to do:</p>
<ul>
<li>Use PowerShell to provision resource groups in four different regions. Each resource group contains an Azure Function App that loads its source code from a code repository.</li>
<li>Use source code changes to trigger updates to all the functions apps at the same time.</li>
<li>Configure the Azure Functions App to test a Web URL or a collection. This test can be sophisticated because we have the full power of an Azure Function to conduct the test. In other words, the test can be running through a use case scenario as opposed to just posting to a URL, for example.</li>
<li>Auto-trigger the Azure Functions by a timer (i.e. configurable) to repeat the test.</li>
<li>Report the source (i.e region), duration, URL, date time and status code to a PowerBI real-time data set at the end of every test iteration.</li>
<li>Create a real-time visualization to see, in real-time, the test results.</li>
<li>Use PowerShell script to de-provision the resource groups when the test is no longer needed.</li>
</ul>
<p>The source code can be found <a href="https://github.com/khaledhikmat/serverless-webtest">here</a>.</p>
<h3 id="macro-architecture">Macro Architecture</h3>
<p><img src="http://i.imgur.com/2NMuHBC.png" class="img-fluid" alt="Web Test using Azure Functions" /></p>
<h3 id="azure-resource-group-template">Azure Resource Group Template</h3>
<p>I downloaded an Azure Function template and modified it to suit my needs. The main thing in the template is that it defines the repository URL and branch from which the source code is to be imported and the definitions of the app strings:</p>
<p>Here is the entire template:</p>
<pre><code>{
    &quot;$schema&quot;: &quot;http://schemas.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&quot;,
    &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
    &quot;parameters&quot;: {
        &quot;appName&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;metadata&quot;: {
                &quot;description&quot;: &quot;The name of the function app that you wish to create.&quot;
            }
        },
        &quot;storageAccountType&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;Standard_LRS&quot;,
            &quot;allowedValues&quot;: [
                &quot;Standard_LRS&quot;,
                &quot;Standard_GRS&quot;,
                &quot;Standard_ZRS&quot;,
                &quot;Premium_LRS&quot;
            ],
            &quot;metadata&quot;: {
                &quot;description&quot;: &quot;Storage Account type&quot;
            }
        },
        &quot;repoURL&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;https://&lt;ourown&gt;.visualstudio.com/DefaultCollection/Misc/_git/WebTest&quot;,
            &quot;metadata&quot;: {
                &quot;description&quot;: &quot;The URL for the GitHub repository that contains the project to deploy.&quot;
            }
        },
        &quot;branch&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;master&quot;,
            &quot;metadata&quot;: {
                &quot;description&quot;: &quot;The branch of the GitHub repository to use.&quot;
            }
        }
    },
    &quot;variables&quot;: {
        &quot;functionAppName&quot;: &quot;[parameters('appName')]&quot;,
        &quot;hostingPlanName&quot;: &quot;[parameters('appName')]&quot;,
        &quot;storageAccountName&quot;: &quot;[concat(uniquestring(resourceGroup().id), 'azfunctions')]&quot;,
        &quot;storageAccountid&quot;: &quot;[concat(resourceGroup().id,'/providers/','Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]&quot;
    },
    &quot;resources&quot;: [
        {
            &quot;type&quot;: &quot;Microsoft.Storage/storageAccounts&quot;,
            &quot;name&quot;: &quot;[variables('storageAccountName')]&quot;,
            &quot;apiVersion&quot;: &quot;2015-06-15&quot;,
            &quot;location&quot;: &quot;[resourceGroup().location]&quot;,
            &quot;properties&quot;: {
                &quot;accountType&quot;: &quot;[parameters('storageAccountType')]&quot;
            }
        },
        {
            &quot;type&quot;: &quot;Microsoft.Web/serverfarms&quot;,
            &quot;apiVersion&quot;: &quot;2015-04-01&quot;,
            &quot;name&quot;: &quot;[variables('hostingPlanName')]&quot;,
            &quot;location&quot;: &quot;[resourceGroup().location]&quot;,
            &quot;properties&quot;: {
                &quot;name&quot;: &quot;[variables('hostingPlanName')]&quot;,
                &quot;computeMode&quot;: &quot;Dynamic&quot;,
                &quot;sku&quot;: &quot;Dynamic&quot;
            }
        },
        {
            &quot;apiVersion&quot;: &quot;2015-08-01&quot;,
            &quot;type&quot;: &quot;Microsoft.Web/sites&quot;,
            &quot;name&quot;: &quot;[variables('functionAppName')]&quot;,
            &quot;location&quot;: &quot;[resourceGroup().location]&quot;,
            &quot;kind&quot;: &quot;functionapp&quot;,            
            &quot;dependsOn&quot;: [
                &quot;[resourceId('Microsoft.Web/serverfarms', variables('hostingPlanName'))]&quot;,
                &quot;[resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName'))]&quot;
            ],
            &quot;properties&quot;: {
                &quot;serverFarmId&quot;: &quot;[resourceId('Microsoft.Web/serverfarms', variables('hostingPlanName'))]&quot;,
                &quot;siteConfig&quot;: {
                    &quot;appSettings&quot;: [
                        {
                            &quot;name&quot;: &quot;AzureWebJobsDashboard&quot;,
                            &quot;value&quot;: &quot;[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageAccountName'), ';AccountKey=', listKeys(variables('storageAccountid'),'2015-05-01-preview').key1)]&quot;
                        },
                        {
                            &quot;name&quot;: &quot;AzureWebJobsStorage&quot;,
                            &quot;value&quot;: &quot;[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageAccountName'), ';AccountKey=', listKeys(variables('storageAccountid'),'2015-05-01-preview').key1)]&quot;
                        },
                        {
                            &quot;name&quot;: &quot;WEBSITE_CONTENTAZUREFILECONNECTIONSTRING&quot;,
                            &quot;value&quot;: &quot;[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageAccountName'), ';AccountKey=', listKeys(variables('storageAccountid'),'2015-05-01-preview').key1)]&quot;
                        },
                        {
                            &quot;name&quot;: &quot;WEBSITE_CONTENTSHARE&quot;,
                            &quot;value&quot;: &quot;[toLower(variables('functionAppName'))]&quot;
                        },
                        {
                            &quot;name&quot;: &quot;FUNCTIONS_EXTENSION_VERSION&quot;,
                            &quot;value&quot;: &quot;~1&quot;
                        },
                        {
                            &quot;name&quot;: &quot;WEBSITE_NODE_DEFAULT_VERSION&quot;,
                            &quot;value&quot;: &quot;6.5.0&quot;
                        },
                        {
                            &quot;name&quot;: &quot;location&quot;,
                            &quot;value&quot;: &quot;[resourceGroup().location]&quot;
                        },
                        {
                            &quot;name&quot;: &quot;testUrl&quot;,
                            &quot;value&quot;: &quot;http://your-own.azurewebsites.net&quot;
                        }
                    ]
                }
            }, 
            &quot;resources&quot;: [
                {
                    &quot;apiVersion&quot;: &quot;2015-08-01&quot;,
                    &quot;name&quot;: &quot;web&quot;,
                    &quot;type&quot;: &quot;sourcecontrols&quot;,
                    &quot;dependsOn&quot;: [
                        &quot;[resourceId('Microsoft.Web/Sites', variables('functionAppName'))]&quot;
                    ],
                    &quot;properties&quot;: {
                        &quot;RepoUrl&quot;: &quot;[parameters('repoURL')]&quot;,
                        &quot;branch&quot;: &quot;[parameters('branch')]&quot;,
                        &quot;isManualIntegration&quot;: false
                    }
                }
            ]                     
        }
    ]
}

</code></pre>
<p>Here is the template parameters file:</p>
<pre><code>{
  &quot;$schema&quot;: &quot;http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#&quot;,
  &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
  &quot;parameters&quot;: {
    &quot;appName&quot;: {
      &quot;value&quot;: &quot;WebTestFunctions&quot;
    }
  }
}
</code></pre>
<h3 id="powershell-script">PowerShell Script</h3>
<p>The PowerShell script is the main driver that orchestrates the deployment and of the different Azure Functions to different resource groups. Here is the complete script:</p>
<pre><code># Login to Azure first
Login-AzureRmAccount

# Select the subscription
Get-AzureRmSubscription | select SubscriptionName
$subscr = &quot;YourOwn&quot;
Select-AzureRmSubscription -SubscriptionName $subscr

# 1. create a new resource group in west US
New-AzureRmResourceGroup -Name WebTest4WestUS -Location &quot;West US&quot;

# 1.5. deploy the template to the west us resource group
New-AzureRmResourceGroupDeployment -Name WebTest4WestUSDeployment -ResourceGroupName WebTest4WestUS `
  -TemplateFile azuredeploy.json  

# 2. create a new resource group in west europe
New-AzureRmResourceGroup -Name WebTest4WestEurope -Location &quot;West Europe&quot;

# 2.5. deploy the template to the west europe resource group
New-AzureRmResourceGroupDeployment -Name WebTest4WestEuropeDeployment -ResourceGroupName WebTest4WestEurope `
  -TemplateFile azuredeploy.json

# 3. create a new resource group in West Japan
New-AzureRmResourceGroup -Name WebTest4WestJapan -Location &quot;Japan West&quot;

# 3.5. deploy the template to the west japan resource group
New-AzureRmResourceGroupDeployment -Name WebTest4WestJapanDeployment -ResourceGroupName WebTest4WestJapan `
  -TemplateFile azuredeploy.json    

# 4. create a new resource group in South Brazil
New-AzureRmResourceGroup -Name WebTest4SouthBrazil -Location &quot;Brazil South&quot;

# 4.5. deploy the template to the south brazil resource group
New-AzureRmResourceGroupDeployment -Name WebTest4SouthBrazilDeployment -ResourceGroupName WebTest4SouthBrazil `
  -TemplateFile azuredeploy.json  
  
######

# Delete the resource groups
Remove-AzureRmResourceGroup -Name WebTest4WestUS -Force
Remove-AzureRmResourceGroup -Name WebTest4WestEurope -Force
Remove-AzureRmResourceGroup -Name WebTest4WestJapan -Force
Remove-AzureRmResourceGroup -Name WebTest4SouthBrazil -Force   
</code></pre>
<p>Once you run the deployments, u will see something like this in your subscription resource groups:</p>
<p><img src="http://i.imgur.com/8LgDuHA.png" class="img-fluid" alt="Resource Groups" /></p>
<h3 id="powerbi-real-time-dataset">PowerBI Real-Time Dataset</h3>
<p>Using this <a href="https://powerbi.microsoft.com/en-us/documentation/powerbi-service-real-time-streaming/">nifty feature</a> in PowerBI, I defined a real-time dataset that looks like this:</p>
<p><img src="http://i.imgur.com/x6SvVgS.png" class="img-fluid" alt="PowerBI Real Time Dataset" /></p>
<p>This gave me a URL that I can use from Azure Functions to pump data into this Real-time dataset. Also please note that I enbaled the <code>historic data analysis</code> to allow me to report on the data and visualize it in real-time and beyond.</p>
<h3 id="azure-function-source-code">Azure Function Source Code</h3>
<p>Finally, the Azure Function source code that conducts the test and reports to PowerBI:</p>
<pre><code>#r &quot;Newtonsoft.Json&quot;

using System;
using System.Text;
using System.Net;
using System.Net.Http;
using System.Net.Http.Headers;
using Newtonsoft.Json;

public static async Task Run(TimerInfo cacheTimer, TraceWriter log)
{
    var location = GetEnvironmentVariable(&quot;location&quot;);
    log.Info($&quot;Web Test trigger executed at {DateTime.Now} from {location}&quot;);    

    try 
    {
        var testUrl = GetEnvironmentVariable(&quot;testUrl&quot;);
        if (!string.IsNullOrEmpty(testUrl))
        {
            string [] results = await TestUrl(testUrl, log);                
            if (results != null &amp;&amp; results.Length == 2)
            {
                // Condition the event to meet the Real-Time PowerBI expectation
                var realTimeEvent = new {
                    time = DateTime.Now,
                    source = GetEnvironmentVariable(&quot;location&quot;),
                    url  = testUrl,
                    duration  = Double.Parse(results[1]),
                    result = results[0]
                };

                var events = new List&lt;dynamic&gt;();
                events.Add(realTimeEvent);
                await PostToPowerBI(events, log);
            }
            else
            {
                log.Info($&quot;Bad results from testing url!&quot;);
            }
        }
        else
            log.Info($&quot;No Test URL!&quot;);
    }
    catch (Exception e)
    {
        log.Info($&quot;Encountered a failure: {e.Message}&quot;);
    }
}

private async static Task&lt;string []&gt; TestUrl(string url, TraceWriter log)
{
    var results = new string[2];
    var statusCode = &quot;&quot;;
    HttpClient client = null;
    DateTime startTime = DateTime.Now;
    DateTime endTime = DateTime.Now;

    try
    {
        client = new HttpClient();

        HttpResponseMessage response = await client.GetAsync(url);
        statusCode = response.StatusCode.ToString();    
    }
    catch (Exception ex)
    {
        log.Info($&quot;TestUrl failed: {ex.Message}&quot;);
        statusCode = &quot;500&quot;;
    }
    finally
    {
        if (client != null)
            client.Dispose();
    }

    endTime = DateTime.Now;
    results[0] = statusCode;
    results[1] = (endTime - startTime).TotalSeconds + &quot;&quot;;
    return results;
}

private async static Task PostToPowerBI(object realTimeEvents, TraceWriter log)
{
    HttpClient client = null;
    // The URL for PowerBI Real Time Dataset
    var url = &quot;https://api.powerbi.com/beta/your-own&quot;; // Should be made into an app setting

    try
    {
        client = new HttpClient();

        var postData = Newtonsoft.Json.JsonConvert.SerializeObject(realTimeEvents);
        HttpContent httpContent = new StringContent(postData, Encoding.UTF8, &quot;application/json&quot;);
        HttpResponseMessage response = await client.PostAsync(url , httpContent);
        string responseString = await response.Content.ReadAsStringAsync();

        if (!response.IsSuccessStatusCode)
        {
            throw new Exception(&quot;Bad return code: &quot; + response.StatusCode);
        }
    }
    catch (Exception ex)
    {
        log.Info($&quot;PostToPowerBI failed: {ex.Message}&quot;);
    }
    finally
    {
        if (client != null)
            client.Dispose();
    }
}

public static string GetEnvironmentVariable(string name)
{
    return System.Environment.GetEnvironmentVariable(name, EnvironmentVariableTarget.Process);
}
</code></pre>
<h3 id="results-visualization">Results Visualization</h3>
<p>If we deploy the Azure Functions and collect the results in PowerBI, we can get real-time results that look like this:</p>
<p><img src="http://i.imgur.com/Dc1B6Jm.png" class="img-fluid" alt="Web Test Results 1" /></p>
<p><img src="http://i.imgur.com/ZI3Qfps.png" class="img-fluid" alt="Web Test Results 2" /></p>
<p>Hopefully this visualization helps executives to see a clear indication that the product launch is not that successful :-)</p>
<h2 id="service-fabric">Service Fabric</h2>
<p>I also wanted to mantion that Azure Service Fabric could also be used to conduct a web test from hammering the test site from multiple instances. Briefly, here is what I thought of doing:</p>
<ul>
<li>Create a Web Test Application Type. The Service Fabric app contains a single stateless service which does work on its RunAsync method.</li>
<li>Use a PowerShell script to instantiate multiple tenants (or named applications): one for each region. Please note that the tenants simulate the different regions as they are all sitting in the same cluster!</li>
<li>Update (i.e increase or decrease the number of the stateless service instances) each tenant (or named application) independently. This means that, unlike the Azure Functions, the system under-test can be hammered from multiple instances within the same tenant if need be.</li>
<li>Write sophisticated tests within Service Fabric because the stateless service is doing it and the service can have a lot of configuration to govern that process.</li>
<li>Report the source (i.e region), duration, URL, date time and status code to a PowerBI real-time data set at the end of every test iteration.</li>
<li>Create a real-time visualization to see, in real-time, the test results.</li>
<li>Use PowerShell script to de-provision the resource groups when the test is no longer needed.</li>
</ul>
<p>I will publish the Service Fabric web test solution in a different blog post. For now, here is the macro architecture that I am thinking about:</p>
<p><img src="http://i.imgur.com/3f1bA7X.png" class="img-fluid" alt="Azure Service Fabric Macro Architecture" /></p>



                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                <ul class="list-inline text-center">
                        <li>
                        <a href="https://twitter.com/khaledhmat">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://github.com/khaledhikmat">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                </ul>
                <p class="copyright text-muted">
                        Copyright © 2017 by Khaled Hikmat. 
                        <br />
                        <strong><a href="http://wyam.io">Generated by Wyam</a></strong>
                </p>
                </div>
        </div>
</div>
                </footer> 

                <script type="text/javascript">
</script>
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>
        </body>
</html>

