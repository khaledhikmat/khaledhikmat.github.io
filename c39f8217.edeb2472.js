(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{118:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return s}));var r=n(3),a=n(7),o=(n(0),n(138)),i={title:"Azure CLI Notes",author:"Khaled Hikmat",author_title:"Software Engineer",author_url:"https://github.com/khaledhikmat",author_image_url:"https://avatars1.githubusercontent.com/u/3119726?s=400&u=090899e7b366dd702f9d0d5e483f20089010b25c&v=4",tags:["Azure"]},c={permalink:"/blog/2018/01/02/azure-cli-login-options",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2018-01-02-azure-cli-login-options.md",source:"@site/blog/2018-01-02-azure-cli-login-options.md",description:"This is just a note about Azure CLI login options.",date:"2018-01-02T00:00:00.000Z",tags:[{label:"Azure",permalink:"/blog/tags/azure"}],title:"Azure CLI Notes",readingTime:1.545,truncated:!1,prevItem:{title:".NET Core, Docker and Kubernetes",permalink:"/blog/2018/01/04/netapp-docker-k8s"},nextItem:{title:"Actors in Serverless",permalink:"/blog/2017/12/27/durable-functions"}},l=[{value:"Option 1:",id:"option-1",children:[]},{value:"Option 2:",id:"option-2",children:[{value:"Create a service principal:",id:"create-a-service-principal",children:[]}]},{value:"Useful Commands:",id:"useful-commands",children:[]},{value:"Kubernetes",id:"kubernetes",children:[]}],p={toc:l};function s(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"This is just a note about ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://docs.microsoft.com/en-us/cli/azure/overview?view=azure-cli-latest"}),"Azure CLI")," login options."),Object(o.b)("h2",{id:"option-1"},"Option 1:"),Object(o.b)("p",null,"Login interactively via a browser"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"az login\n")),Object(o.b)("h2",{id:"option-2"},"Option 2:"),Object(o.b)("p",null,"The best way to login is to use an Azure Service Principal though. So I registered an application in Azure Directory i.e. ",Object(o.b)("inlineCode",{parentName:"p"},"AzureCliScriptApp")," and assigned a service principal. I will use this service principal to login."),Object(o.b)("h3",{id:"create-a-service-principal"},"Create a service principal:"),Object(o.b)("p",null,"Make sure you are in the same tenant that you want to authenticate against. If not, use 'az account set --subscription \"your-subs\"' to set the account."),Object(o.b)("p",null,"To display the Azure Directory apps:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"az ad app list --display-name AzureCliScriptApp\n")),Object(o.b)("p",null,"The above will yield the app id ...a big string that looks like this: ",Object(o.b)("inlineCode",{parentName:"p"},"e68ab97f-cff2-4b50-83d5-eec9fe266ccc")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'az ad sp create-for-rbac --name e68ab97f-cff2-4b50-83d5-eec9fe266ccc --password s0me_passw0rd\n{\n  "appId": "some-app-id-you-will-use-to-sign-in",\n  "displayName": "e68ab97f-cff2-4b50-83d5-eec9fe266ccc",\n  "name": "http://e68ab97f-cff2-4b50-83d5-eec9fe266ccc",\n  "password": "s0me_passw0rd",\n  "tenant": "your-tenant-id"\n}\n')),Object(o.b)("p",null,"To login with service principal:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"az login --service-principal -u some-app-id-you-will-use-to-sign-in -p s0me_passw0rd --tenant your-tenant-id\n")),Object(o.b)("h2",{id:"useful-commands"},"Useful Commands:"),Object(o.b)("p",null,"List all subscriptions"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"az account list --output table\n")),Object(o.b)("p",null,"Set the default account"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'az account set --subscription "Mosaic"\n')),Object(o.b)("p",null,"List the Clouds"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"az cloud list --output table\naz cloud show --name AzureCloud --output json\n")),Object(o.b)("h2",{id:"kubernetes"},"Kubernetes"),Object(o.b)("p",null,"if you are using the Azure CLI to provision a Kubernetes cluster, you should use this command if you used the service principal to login"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"az aks create --resource-group $rgName --name $k8sClusterName --service-principal $spAppId --client-secret $spPassword --node-count $k8sNodesCount --generate-ssh-keys\n")),Object(o.b)("p",null,"Where:\n",Object(o.b)("inlineCode",{parentName:"p"},"$rgName")," is the PowerShell variable that holds the resource group name\n",Object(o.b)("inlineCode",{parentName:"p"},"$k8sClusterName")," is the PowerShell variable that holds the k8s cluster name\n",Object(o.b)("inlineCode",{parentName:"p"},"$spAppId")," is the PowerShell variable that holds the service principal app id\n",Object(o.b)("inlineCode",{parentName:"p"},"$spPassword")," is the PowerShell variable that holds the service principal password\n",Object(o.b)("inlineCode",{parentName:"p"},"$k8sNodesCount")," is the PowerShell variable that holds the k8s cluster desired nodes count"),Object(o.b)("p",null,"Refer to this ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://docs.microsoft.com/en-us/azure/aks/kubernetes-service-principal"}),"doc")," for more information"))}s.isMDXComponent=!0},138:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),s=function(e){var t=a.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},u=function(e){var t=s(e.components);return a.a.createElement(p.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(n),d=r,m=u["".concat(i,".").concat(d)]||u[d]||b[d]||o;return n?a.a.createElement(m,c(c({ref:t},p),{},{components:n})):a.a.createElement(m,c({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var p=2;p<o;p++)i[p]=n[p];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);