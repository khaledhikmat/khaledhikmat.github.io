<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Coding Thoughts Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Coding Thoughts Blog Atom Feed"><title data-react-helmet="true">Web Tests Thoughts | Coding Thoughts</title><meta data-react-helmet="true" property="og:title" content="Web Tests Thoughts | Coding Thoughts"><meta data-react-helmet="true" name="description" content="If a Web App is deployed on Azure, both the App Insights and Web Apps offer a utility that can hammer the app&#x27;s endpoints from different regions. While this functionality is quite nice and comes bundled in, it is considered an alert-based system and is slightly rudimentary as one cannot customize the test or get access to the full results easily. This post describes an alternative approach that uses Azure Functions or Service Fabric to implement a web test that can test and endpoint and report its test to PowerBI in real time."><meta data-react-helmet="true" property="og:description" content="If a Web App is deployed on Azure, both the App Insights and Web Apps offer a utility that can hammer the app&#x27;s endpoints from different regions. While this functionality is quite nice and comes bundled in, it is considered an alert-based system and is slightly rudimentary as one cannot customize the test or get access to the full results easily. This post describes an alternative approach that uses Azure Functions or Service Fabric to implement a web test that can test and endpoint and report its test to PowerBI in real time."><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/styles.157dcc77.css">
<link rel="preload" href="/styles.4fbf0ec5.js" as="script">
<link rel="preload" href="/runtime~main.fc898453.js" as="script">
<link rel="preload" href="/main.ece73c67.js" as="script">
<link rel="preload" href="/1.4ea9cb82.js" as="script">
<link rel="preload" href="/2.dd29e16f.js" as="script">
<link rel="preload" href="/ccc49370.7b39bdf5.js" as="script">
<link rel="preload" href="/ccb03a98.23fefe2f.js" as="script">
<link rel="preload" href="/f17759fd.2305bc44.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/chalk.jpg" alt="Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/chalk.jpg" alt="Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Khaled Hikmat</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/khaledhikmat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/chalk.jpg" alt="Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/chalk.jpg" alt="Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Khaled Hikmat</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/khaledhikmat" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2018/01/06/kubernetes-vs-service-fabric">Kubernetes vs. Service Fabric</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2018/01/04/netapp-docker-k8s">.NET Core, Docker and Kubernetes</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2018/01/02/azure-cli-login-options">Azure CLI Notes</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2017/12/27/durable-functions">Actors in Serverless</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2017/12/21/point-to-site-connectivity">Point to Site Connectivity in Azure</a></li></ul></div></div><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_3-lP">Web Tests Thoughts</h1><div class="margin-vert--md"><time datetime="2017-02-15T00:00:00.000Z" class="blogPostDate_Ta7i">February 15, 2017  Â· 8 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/khaledhikmat" target="_blank" rel="noreferrer noopener"><img src="https://avatars1.githubusercontent.com/u/3119726?s=400&amp;u=090899e7b366dd702f9d0d5e483f20089010b25c&amp;v=4" alt="Khaled Hikmat"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/khaledhikmat" target="_blank" rel="noreferrer noopener">Khaled Hikmat</a></h4><small class="avatar__subtitle">Software Engineer</small></div></div></header><section class="markdown"><p>If a Web App is deployed on Azure, both the <a href="https://azure.microsoft.com/en-us/services/application-insights/" target="_blank" rel="noopener noreferrer">App Insights</a> and <a href="https://azure.microsoft.com/en-us/services/app-service/web/" target="_blank" rel="noopener noreferrer">Web Apps</a> offer a utility that can hammer the app&#x27;s endpoints from different regions. While this functionality is quite nice and comes bundled in, it is considered an alert-based system and is slightly rudimentary as one cannot customize the test or get access to the full results easily. This post describes an alternative approach that uses <a href="https://azure.microsoft.com/en-us/services/functions/" target="_blank" rel="noopener noreferrer">Azure Functions</a> or <a href="https://azure.microsoft.com/en-us/services/service-fabric/" target="_blank" rel="noopener noreferrer">Service Fabric</a> to implement a web test that can test and endpoint and report its test to PowerBI in real time.</p><p>What I really wanted to do is to conduct a web test for a duration of time from different regions against a new product&#x27;s endpoints at launch time and immediately view the test results with executives. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="azure-functions"></a>Azure Functions<a class="hash-link" href="#azure-functions" title="Direct link to heading">#</a></h2><p>Briefly, here is what I decided to do:</p><ul><li>Use PowerShell to provision resource groups in four different regions. Each resource group contains an Azure Function App that loads its source code from a code repository.</li><li>Use source code changes to trigger updates to all the functions apps at the same time.</li><li>Configure the Azure Functions App to test a Web URL or a collection. This test can be sophisticated because we have the full power of an Azure Function to conduct the test. In other words, the test can be running through a use case scenario as opposed to just posting to a URL, for example. </li><li>Auto-trigger the Azure Functions by a timer (i.e. configurable) to repeat the test.</li><li>Report the source (i.e region), duration, URL, date time and status code to a PowerBI real-time data set at the end of every test iteration.</li><li>Create a real-time visualization to see, in real-time, the test results.</li><li>Use PowerShell script to de-provision the resource groups when the test is no longer needed. </li></ul><p>The source code can be found <a href="https://github.com/khaledhikmat/serverless-webtest" target="_blank" rel="noopener noreferrer">here</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="macro-architecture"></a>Macro Architecture<a class="hash-link" href="#macro-architecture" title="Direct link to heading">#</a></h3><p><img src="http://i.imgur.com/2NMuHBC.png" alt="Web Test using Azure Functions"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="azure-resource-group-template"></a>Azure Resource Group Template<a class="hash-link" href="#azure-resource-group-template" title="Direct link to heading">#</a></h3><p>I downloaded an Azure Function template and modified it to suit my needs. The main thing in the template is that it defines the repository URL and branch from which the source code is to be imported and the definitions of the app strings:</p><p>Here is the entire template:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;$schema&quot;: &quot;http://schemas.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;parameters&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;appName&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;string&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;metadata&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;The name of the function app that you wish to create.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;storageAccountType&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;string&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;defaultValue&quot;: &quot;Standard_LRS&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;allowedValues&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;Standard_LRS&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;Standard_GRS&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;Standard_ZRS&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;Premium_LRS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;metadata&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;Storage Account type&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;repoURL&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;string&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;defaultValue&quot;: &quot;https://&lt;ourown&gt;.visualstudio.com/DefaultCollection/Misc/_git/WebTest&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;metadata&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;The URL for the GitHub repository that contains the project to deploy.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;branch&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;string&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;defaultValue&quot;: &quot;master&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;metadata&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;The branch of the GitHub repository to use.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;variables&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;functionAppName&quot;: &quot;[parameters(&#x27;appName&#x27;)]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;hostingPlanName&quot;: &quot;[parameters(&#x27;appName&#x27;)]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;storageAccountName&quot;: &quot;[concat(uniquestring(resourceGroup().id), &#x27;azfunctions&#x27;)]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;storageAccountid&quot;: &quot;[concat(resourceGroup().id,&#x27;/providers/&#x27;,&#x27;Microsoft.Storage/storageAccounts/&#x27;, variables(&#x27;storageAccountName&#x27;))]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;resources&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;Microsoft.Storage/storageAccounts&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;name&quot;: &quot;[variables(&#x27;storageAccountName&#x27;)]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;apiVersion&quot;: &quot;2015-06-15&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;location&quot;: &quot;[resourceGroup().location]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;properties&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;accountType&quot;: &quot;[parameters(&#x27;storageAccountType&#x27;)]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;Microsoft.Web/serverfarms&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;apiVersion&quot;: &quot;2015-04-01&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;name&quot;: &quot;[variables(&#x27;hostingPlanName&#x27;)]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;location&quot;: &quot;[resourceGroup().location]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;properties&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;name&quot;: &quot;[variables(&#x27;hostingPlanName&#x27;)]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;computeMode&quot;: &quot;Dynamic&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;sku&quot;: &quot;Dynamic&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;apiVersion&quot;: &quot;2015-08-01&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;Microsoft.Web/sites&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;name&quot;: &quot;[variables(&#x27;functionAppName&#x27;)]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;location&quot;: &quot;[resourceGroup().location]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;kind&quot;: &quot;functionapp&quot;,            </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;dependsOn&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;[resourceId(&#x27;Microsoft.Web/serverfarms&#x27;, variables(&#x27;hostingPlanName&#x27;))]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;[resourceId(&#x27;Microsoft.Storage/storageAccounts&#x27;, variables(&#x27;storageAccountName&#x27;))]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;properties&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;serverFarmId&quot;: &quot;[resourceId(&#x27;Microsoft.Web/serverfarms&#x27;, variables(&#x27;hostingPlanName&#x27;))]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;siteConfig&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;appSettings&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;name&quot;: &quot;AzureWebJobsDashboard&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;value&quot;: &quot;[concat(&#x27;DefaultEndpointsProtocol=https;AccountName=&#x27;, variables(&#x27;storageAccountName&#x27;), &#x27;;AccountKey=&#x27;, listKeys(variables(&#x27;storageAccountid&#x27;),&#x27;2015-05-01-preview&#x27;).key1)]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;name&quot;: &quot;AzureWebJobsStorage&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;value&quot;: &quot;[concat(&#x27;DefaultEndpointsProtocol=https;AccountName=&#x27;, variables(&#x27;storageAccountName&#x27;), &#x27;;AccountKey=&#x27;, listKeys(variables(&#x27;storageAccountid&#x27;),&#x27;2015-05-01-preview&#x27;).key1)]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;name&quot;: &quot;WEBSITE_CONTENTAZUREFILECONNECTIONSTRING&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;value&quot;: &quot;[concat(&#x27;DefaultEndpointsProtocol=https;AccountName=&#x27;, variables(&#x27;storageAccountName&#x27;), &#x27;;AccountKey=&#x27;, listKeys(variables(&#x27;storageAccountid&#x27;),&#x27;2015-05-01-preview&#x27;).key1)]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;name&quot;: &quot;WEBSITE_CONTENTSHARE&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;value&quot;: &quot;[toLower(variables(&#x27;functionAppName&#x27;))]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;name&quot;: &quot;FUNCTIONS_EXTENSION_VERSION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;value&quot;: &quot;~1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;name&quot;: &quot;WEBSITE_NODE_DEFAULT_VERSION&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;value&quot;: &quot;6.5.0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;name&quot;: &quot;location&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;value&quot;: &quot;[resourceGroup().location]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;name&quot;: &quot;testUrl&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            &quot;value&quot;: &quot;http://your-own.azurewebsites.net&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;resources&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;apiVersion&quot;: &quot;2015-08-01&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;name&quot;: &quot;web&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;type&quot;: &quot;sourcecontrols&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;dependsOn&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        &quot;[resourceId(&#x27;Microsoft.Web/Sites&#x27;, variables(&#x27;functionAppName&#x27;))]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;properties&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        &quot;RepoUrl&quot;: &quot;[parameters(&#x27;repoURL&#x27;)]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        &quot;branch&quot;: &quot;[parameters(&#x27;branch&#x27;)]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        &quot;isManualIntegration&quot;: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ]                     </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Here is the template parameters file:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;$schema&quot;: &quot;http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;parameters&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;appName&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;value&quot;: &quot;WebTestFunctions&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="powershell-script"></a>PowerShell Script<a class="hash-link" href="#powershell-script" title="Direct link to heading">#</a></h3><p>The PowerShell script is the main driver that orchestrates the deployment and of the different Azure Functions to different resource groups. Here is the complete script:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Login to Azure first</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Login-AzureRmAccount</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Select the subscription</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Get-AzureRmSubscription | select SubscriptionName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$subscr = &quot;YourOwn&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Select-AzureRmSubscription -SubscriptionName $subscr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 1. create a new resource group in west US</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">New-AzureRmResourceGroup -Name WebTest4WestUS -Location &quot;West US&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 1.5. deploy the template to the west us resource group</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">New-AzureRmResourceGroupDeployment -Name WebTest4WestUSDeployment -ResourceGroupName WebTest4WestUS `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -TemplateFile azuredeploy.json  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 2. create a new resource group in west europe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">New-AzureRmResourceGroup -Name WebTest4WestEurope -Location &quot;West Europe&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 2.5. deploy the template to the west europe resource group</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">New-AzureRmResourceGroupDeployment -Name WebTest4WestEuropeDeployment -ResourceGroupName WebTest4WestEurope `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -TemplateFile azuredeploy.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 3. create a new resource group in West Japan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">New-AzureRmResourceGroup -Name WebTest4WestJapan -Location &quot;Japan West&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 3.5. deploy the template to the west japan resource group</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">New-AzureRmResourceGroupDeployment -Name WebTest4WestJapanDeployment -ResourceGroupName WebTest4WestJapan `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -TemplateFile azuredeploy.json    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 4. create a new resource group in South Brazil</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">New-AzureRmResourceGroup -Name WebTest4SouthBrazil -Location &quot;Brazil South&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 4.5. deploy the template to the south brazil resource group</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">New-AzureRmResourceGroupDeployment -Name WebTest4SouthBrazilDeployment -ResourceGroupName WebTest4SouthBrazil `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -TemplateFile azuredeploy.json  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">######</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Delete the resource groups</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Remove-AzureRmResourceGroup -Name WebTest4WestUS -Force</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Remove-AzureRmResourceGroup -Name WebTest4WestEurope -Force</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Remove-AzureRmResourceGroup -Name WebTest4WestJapan -Force</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Remove-AzureRmResourceGroup -Name WebTest4SouthBrazil -Force   </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Once you run the deployments, u will see something like this in your subscription resource groups:</p><p><img src="http://i.imgur.com/8LgDuHA.png" alt="Resource Groups"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="powerbi-real-time-dataset"></a>PowerBI Real-Time Dataset<a class="hash-link" href="#powerbi-real-time-dataset" title="Direct link to heading">#</a></h3><p>Using this <a href="https://powerbi.microsoft.com/en-us/documentation/powerbi-service-real-time-streaming/" target="_blank" rel="noopener noreferrer">nifty feature</a> in PowerBI, I defined a real-time dataset that looks like this:</p><p><img src="http://i.imgur.com/x6SvVgS.png" alt="PowerBI Real Time Dataset"></p><p>This gave me a URL that I can use from Azure Functions to pump data into this Real-time dataset. Also please note that I enbaled the <code>historic data analysis</code> to allow me to report on the data and visualize it in real-time and beyond.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="azure-function-source-code"></a>Azure Function Source Code<a class="hash-link" href="#azure-function-source-code" title="Direct link to heading">#</a></h3><p>Finally, the Azure Function source code that conducts the test and reports to PowerBI:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#r &quot;Newtonsoft.Json&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Text;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Net;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Net.Http;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Net.Http.Headers;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using Newtonsoft.Json;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public static async Task Run(TimerInfo cacheTimer, TraceWriter log)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var location = GetEnvironmentVariable(&quot;location&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    log.Info($&quot;Web Test trigger executed at {DateTime.Now} from {location}&quot;);    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    try </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var testUrl = GetEnvironmentVariable(&quot;testUrl&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (!string.IsNullOrEmpty(testUrl))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            string [] results = await TestUrl(testUrl, log);                </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if (results != null &amp;&amp; results.Length == 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                // Condition the event to meet the Real-Time PowerBI expectation</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                var realTimeEvent = new {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    time = DateTime.Now,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    source = GetEnvironmentVariable(&quot;location&quot;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    url  = testUrl,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    duration  = Double.Parse(results[1]),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    result = results[0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                var events = new List&lt;dynamic&gt;();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                events.Add(realTimeEvent);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                await PostToPowerBI(events, log);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                log.Info($&quot;Bad results from testing url!&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            log.Info($&quot;No Test URL!&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    catch (Exception e)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        log.Info($&quot;Encountered a failure: {e.Message}&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">private async static Task&lt;string []&gt; TestUrl(string url, TraceWriter log)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var results = new string[2];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var statusCode = &quot;&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    HttpClient client = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    DateTime startTime = DateTime.Now;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    DateTime endTime = DateTime.Now;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    try</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        client = new HttpClient();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        HttpResponseMessage response = await client.GetAsync(url);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        statusCode = response.StatusCode.ToString();    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    catch (Exception ex)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        log.Info($&quot;TestUrl failed: {ex.Message}&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        statusCode = &quot;500&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    finally</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (client != null)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            client.Dispose();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    endTime = DateTime.Now;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    results[0] = statusCode;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    results[1] = (endTime - startTime).TotalSeconds + &quot;&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return results;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">private async static Task PostToPowerBI(object realTimeEvents, TraceWriter log)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    HttpClient client = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // The URL for PowerBI Real Time Dataset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var url = &quot;https://api.powerbi.com/beta/your-own&quot;; // Should be made into an app setting</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    try</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        client = new HttpClient();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var postData = Newtonsoft.Json.JsonConvert.SerializeObject(realTimeEvents);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        HttpContent httpContent = new StringContent(postData, Encoding.UTF8, &quot;application/json&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        HttpResponseMessage response = await client.PostAsync(url , httpContent);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        string responseString = await response.Content.ReadAsStringAsync();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (!response.IsSuccessStatusCode)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            throw new Exception(&quot;Bad return code: &quot; + response.StatusCode);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    catch (Exception ex)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        log.Info($&quot;PostToPowerBI failed: {ex.Message}&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    finally</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (client != null)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            client.Dispose();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public static string GetEnvironmentVariable(string name)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return System.Environment.GetEnvironmentVariable(name, EnvironmentVariableTarget.Process);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="results-visualization"></a>Results Visualization<a class="hash-link" href="#results-visualization" title="Direct link to heading">#</a></h3><p>If we deploy the Azure Functions and collect the results in PowerBI, we can get real-time results that look like this:</p><p><img src="http://i.imgur.com/Dc1B6Jm.png" alt="Web Test Results 1"></p><p><img src="http://i.imgur.com/ZI3Qfps.png" alt="Web Test Results 2"></p><p>Hopefully this visualization helps executives to see a clear indication that the product launch is not that successful :-) </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="service-fabric"></a>Service Fabric<a class="hash-link" href="#service-fabric" title="Direct link to heading">#</a></h2><p>I also wanted to mantion that Azure Service Fabric could also be used to conduct a web test from hammering the test site from multiple instances. Briefly, here is what I thought of doing:</p><ul><li>Create a Web Test Application Type. The Service Fabric app contains a single stateless service which does work on its RunAsync method.</li><li>Use a PowerShell script to instantiate multiple tenants (or named applications): one for each region. Please note that the tenants simulate the different regions as they are all sitting in the same cluster!</li><li>Update (i.e increase or decrease the number of the stateless service instances) each tenant (or named application) independently. This means that, unlike the Azure Functions, the system under-test can be hammered from multiple instances within the same tenant if need be.</li><li>Write sophisticated tests within Service Fabric because the stateless service is doing it and the service can have a lot of configuration to govern that process.</li><li>Report the source (i.e region), duration, URL, date time and status code to a PowerBI real-time data set at the end of every test iteration.</li><li>Create a real-time visualization to see, in real-time, the test results.</li><li>Use PowerShell script to de-provision the resource groups when the test is no longer needed. </li></ul><p>I will publish the Service Fabric web test solution in a different blog post. For now, here is the macro architecture that I am thinking about:</p><p><img src="http://i.imgur.com/3f1bA7X.png" alt="Azure Service Fabric Macro Architecture"></p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/test">Test</a></div></footer></article><div><a href="https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2017-02-15-web-test-thoughts.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2017/02/21/service-fabric-secure-cluster"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Service Fabric Secure Cluster Deployment</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2017/01/10/service-fabric-notes"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Service Fabric Notes Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#azure-functions" class="table-of-contents__link">Azure Functions</a><ul><li><a href="#macro-architecture" class="table-of-contents__link">Macro Architecture</a></li><li><a href="#azure-resource-group-template" class="table-of-contents__link">Azure Resource Group Template</a></li><li><a href="#powershell-script" class="table-of-contents__link">PowerShell Script</a></li><li><a href="#powerbi-real-time-dataset" class="table-of-contents__link">PowerBI Real-Time Dataset</a></li><li><a href="#azure-function-source-code" class="table-of-contents__link">Azure Function Source Code</a></li><li><a href="#results-visualization" class="table-of-contents__link">Results Visualization</a></li></ul></li><li><a href="#service-fabric" class="table-of-contents__link">Service Fabric</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2020 Khaled Hikmat site, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.4fbf0ec5.js"></script>
<script src="/runtime~main.fc898453.js"></script>
<script src="/main.ece73c67.js"></script>
<script src="/1.4ea9cb82.js"></script>
<script src="/2.dd29e16f.js"></script>
<script src="/ccc49370.7b39bdf5.js"></script>
<script src="/ccb03a98.23fefe2f.js"></script>
<script src="/f17759fd.2305bc44.js"></script>
</body>
</html>